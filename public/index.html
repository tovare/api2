
<!DOCTYPE html>
<html>
    <head>
        <title>Dashboard</title>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
        <!-- Compiled and minified JavaScript -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script>jQuery.noConflict();</script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
    </head>
    
    <body class="black">

    <div class="container">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>

// Rob More did a writeup on a pattern for reusable and updatable charts
// building on an earlier work by Mike Bostock where all configuration
// items where accessible as closures aloowing you to configure the
// chart like this:
//
//      d3.select("#overskrift").datum(activeUsers).height(200);

// However this doesnÂ´t address the need for updating the chart, changing
// the dataset and smooth transitions between states.
//
// 

// ### Showing a number which animates
//
// The number will be updated over a few seconds. This is done by
// selecting the active transition state of the object.
//
// 1. Read initial data and set up the object.
// 2. When completed, poll for new data and call update when completed.
// 3. When new data is available, the update function is responsible for
//    transitioning to the new number.
//
//
//

/*global d3*/
console.log("v2")


d3.json("data/brukere-realtime.json", function(error, data) {
    if(error){ console.log(error); }
    var activeUsers = data.totalsForAllResults['rt:activeUsers'];
    d3.select("#overskrft")
        .datum([activeUsers])
        .html(function (d) {
            console.log("Set value to : "+d);
            return d;
        });
    d3.interval(function() {
        d3.json("data/brukere-realtime.json", function(error, data) {
            if(!error){
                var activeUsers = data.totalsForAllResults['rt:activeUsers'];
                console.log("Updated brukere-realtime: "+ activeUsers);
                d3.select("#overskrft")
                    .transition()
                    .duration(2000)
                    .tween("text", function () {
                        var node = d3.select(this);
                        // Create a function for tween wich is called 
                        // for each step in the transition in the interval [0,1]
                        // where 1 is the completed tranition.
                        var i = d3.interpolateRound(node.datum(), activeUsers);
                        node.datum([activeUsers])
                        return function (t) {
                            node.text(i(t));
                        };
                    });
            }else{
                console.log("failed to update number of users online.");
            }
        });
    }, 5000);
});




        
        </script>


<h1 id="overskrft" class="white-text">0</h1>



     </div>
      
    </body>
</html>